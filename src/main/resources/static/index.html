<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bookshop 管理系統 - 首頁</title>
</head>
<body>

<h1>Bookshop 管理系統</h1>

<ul id="menu">
  <!-- 這裡會由 JS 動態生成 -->
</ul>

<script src="/js/common.js"></script>
<script>
const token = localStorage.getItem("token");
const menu = document.getElementById("menu");

function decodeToken(token) {
  if (!token) return null;
  const payload = token.split('.')[1];
  const decoded = atob(payload);
  return JSON.parse(decoded);
}

function logout() {
  localStorage.removeItem("token");
  alert("已登出");
  window.location.reload();
}

if (!token) {
  // 未登入
  menu.innerHTML = `
    <li><a href="/auth/login.html">🔐 登入</a></li>
    <li><a href="/auth/register.html">👥 註冊</a></li>
  `;
} else {
  const user = decodeToken(token);
  console.log("當前登入的 Token:", token);
  console.log("解碼後的 Payload:", user);

  menu.innerHTML = `
    <li><a href="#" onclick="logout()">🚪 登出</a></li>
  `;
  if (user.roles && user.roles.includes("ROLE_STAFF")) {
    menu.innerHTML += `
    <li><a href="#" id="booksLink">📖 書籍管理</a></li>
    `;
  }
  if (user.roles && user.roles.includes("ROLE_ADMIN")) {
    menu.innerHTML += `
    <li><a href="#" id="usersLink">👤 用戶管理</a></li>
    <li><a href="#" id="rolesLink">🛡️ 角色與權限管理</a></li>
    `;
  }
  if (user.roles && user.roles.includes("ROLE_WORKER")) {
    menu.innerHTML += `
    <li><a href="/swagger-ui/index.html">♻️ swagger</a></li>
    <h1>現在是工作時間 Work Time!</h1>
    `;
  }

  // 書籍管理
  document.getElementById("booksLink")?.addEventListener("click", () => {
    loadPageWithToken("book/books.html");
  });

  // 用戶管理
  document.getElementById("usersLink")?.addEventListener("click", () => {
    loadPageWithToken("/user/users.html");
  });

  // 權限管理
  document.getElementById("rolesLink")?.addEventListener("click", () => {
    loadPageWithToken("/user/roles.html");
  });
}
</script>
</body>
</html>
