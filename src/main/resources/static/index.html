<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bookshop ç®¡ç†ç³»çµ± - é¦–é </title>
</head>
<body>

<h1>Bookshop ç®¡ç†ç³»çµ±</h1>

<ul id="menu">
  <!-- é€™è£¡æœƒç”± JS å‹•æ…‹ç”Ÿæˆ -->
</ul>

<script src="/js/common.js"></script>
<script>
const token = localStorage.getItem("token");
const menu = document.getElementById("menu");

function decodeToken(token) {
  if (!token) return null;
  const payload = token.split('.')[1];
  const decoded = atob(payload);
  return JSON.parse(decoded);
}

function logout() {
  localStorage.removeItem("token");
  alert("å·²ç™»å‡º");
  window.location.reload();
}

if (!token) {
  // æœªç™»å…¥
  menu.innerHTML = `
    <li><a href="/auth/login.html">ğŸ” ç™»å…¥</a></li>
    <li><a href="/auth/register.html">ğŸ‘¥ è¨»å†Š</a></li>
  `;
} else {
  const user = decodeToken(token);
  console.log("ç•¶å‰ç™»å…¥çš„ Token:", token);
  console.log("è§£ç¢¼å¾Œçš„ Payload:", user);

  menu.innerHTML = `
    <li><a href="#" onclick="logout()">ğŸšª ç™»å‡º</a></li>
  `;
  if (user.roles && user.roles.includes("ROLE_STAFF")) {
    menu.innerHTML += `
    <li><a href="#" id="booksLink">ğŸ“– æ›¸ç±ç®¡ç†</a></li>
    `;
  }
  if (user.roles && user.roles.includes("ROLE_ADMIN")) {
    menu.innerHTML += `
    <li><a href="#" id="usersLink">ğŸ‘¤ ç”¨æˆ¶ç®¡ç†</a></li>
    <li><a href="#" id="rolesLink">ğŸ›¡ï¸ è§’è‰²èˆ‡æ¬Šé™ç®¡ç†</a></li>
    `;
  }
  if (user.roles && user.roles.includes("ROLE_WORKER")) {
    menu.innerHTML += `
    <li><a href="/swagger-ui/index.html">â™»ï¸ swagger</a></li>
    <h1>ç¾åœ¨æ˜¯å·¥ä½œæ™‚é–“ Work Time!</h1>
    `;
  }

  // æ›¸ç±ç®¡ç†
  document.getElementById("booksLink")?.addEventListener("click", () => {
    loadPageWithToken("book/books.html");
  });

  // ç”¨æˆ¶ç®¡ç†
  document.getElementById("usersLink")?.addEventListener("click", () => {
    loadPageWithToken("/user/users.html");
  });

  // æ¬Šé™ç®¡ç†
  document.getElementById("rolesLink")?.addEventListener("click", () => {
    loadPageWithToken("/user/roles.html");
  });
}
</script>
</body>
</html>
