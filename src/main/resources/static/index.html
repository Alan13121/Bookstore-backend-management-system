<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸ“š Bookshop ç®¡ç†ç³»çµ± - é¦–é </title>
</head>
<body>

<h1>ğŸ“š Bookshop ç®¡ç†ç³»çµ±</h1>

<ul id="menu">
  <!-- é€™è£¡æœƒç”± JS å‹•æ…‹ç”Ÿæˆ -->
</ul>

<script>
const token = localStorage.getItem("token");
const menu = document.getElementById("menu");

function decodeToken(token) {
  if (!token) return null;
  const payload = token.split('.')[1];
  const decoded = atob(payload);
  return JSON.parse(decoded);
}

function logout() {
  localStorage.removeItem("token");
  alert("å·²ç™»å‡º");
  window.location.reload();
}

if (!token) {
  // æœªç™»å…¥
  menu.innerHTML = `
    <li><a href="/login.html">ğŸ” ç™»å…¥</a></li>
    <li><a href="/register.html">ğŸ‘¥ è¨»å†Š</a></li>
  `;
} else {
  const user = decodeToken(token);
  console.log("ç•¶å‰ç™»å…¥çš„ Token:", token);
  console.log("è§£ç¢¼å¾Œçš„ Payload:", user);

  menu.innerHTML = `
    <li><a href="#" onclick="logout()">ğŸšª ç™»å‡º</a></li>
    <li><a href="/books.html">ğŸ“– æ›¸ç±ç®¡ç†</a></li>
  `;

  if (user.roles && user.roles.includes("ROLE_ADMIN")) {
    menu.innerHTML += `
      <li><a href="/users.html">ğŸ‘¤ ç”¨æˆ¶ç®¡ç†</a></li>
    `;
  }
}
</script>

</body>
</html>
